-- Services
local UserInputService = game:GetService("UserInputService")

-- Create UI components
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local ImageLabel = Instance.new("ImageLabel")
local TabManager = Instance.new("Frame")
local NewTabButton = Instance.new("TextButton")
local ExecuteButton = Instance.new("TextButton")
local CloseButton = Instance.new("TextButton")

-- Set up the ScreenGui
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- Set up the MainFrame
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundTransparency = 0
MainFrame.BorderSizePixel = 0
MainFrame.ZIndex = 1
MainFrame.ClipsDescendants = true

-- Round corners for MainFrame
local UICornerMain = Instance.new("UICorner")
UICornerMain.CornerRadius = UDim.new(0, 15)
UICornerMain.Parent = MainFrame

-- Outline for MainFrame
local UIStrokeMain = Instance.new("UIStroke")
UIStrokeMain.Parent = MainFrame
UIStrokeMain.Color = Color3.fromRGB(255, 255, 255)
UIStrokeMain.Thickness = 2

-- Set up the TitleLabel
TitleLabel.Parent = MainFrame
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0.1, 0, 0, 0)
TitleLabel.Size = UDim2.new(0, 300, 0, 30)
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.Text = "Recon V1.0.1"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 20
TitleLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Set up the ImageLabel
ImageLabel.Parent = MainFrame
ImageLabel.BackgroundTransparency = 1
ImageLabel.Position = UDim2.new(0, 5, 0, 5)
ImageLabel.Size = UDim2.new(0, 20, 0, 20)
ImageLabel.Image = "rbxassetid://18716840405"

-- Set up the CloseButton
CloseButton.Parent = MainFrame
CloseButton.BackgroundTransparency = 1
CloseButton.Position = UDim2.new(1, -25, 0, 5)
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 20
CloseButton.BorderSizePixel = 0

-- Set up the TabManager
TabManager.Parent = MainFrame
TabManager.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
TabManager.Size = UDim2.new(1, 0, 0, 30)
TabManager.Position = UDim2.new(0, 0, 0, 30)

-- Outline for TabManager
local UIStrokeTabManager = Instance.new("UIStroke")
UIStrokeTabManager.Parent = TabManager
UIStrokeTabManager.Color = Color3.fromRGB(255, 255, 255)
UIStrokeTabManager.Thickness = 2

-- Set up the NewTabButton
NewTabButton.Parent = TabManager
NewTabButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
NewTabButton.Size = UDim2.new(0, 50, 1, 0)
NewTabButton.Position = UDim2.new(1, -50, 0, 0)
NewTabButton.Text = "+"
NewTabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
NewTabButton.BorderSizePixel = 0

-- Set up the ExecuteButton
ExecuteButton.Parent = MainFrame
ExecuteButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ExecuteButton.Position = UDim2.new(0.9, -80, 1, -30)
ExecuteButton.Size = UDim2.new(0, 70, 0, 25)
ExecuteButton.Font = Enum.Font.SourceSans
ExecuteButton.Text = "Execute"
ExecuteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ExecuteButton.TextSize = 14
ExecuteButton.BorderSizePixel = 0

-- Store a list of CodeBoxes for different tabs
local CodeBoxes = {}

-- Function to create new tabs
local function createNewTab()
    local TabButton = Instance.new("TextButton")
    local CloseTabButton = Instance.new("TextButton")
    local CodeBox = Instance.new("TextBox")

    -- Set up the TabButton
    TabButton.Parent = TabManager
    TabButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    TabButton.Size = UDim2.new(0, 100, 1, 0)
    TabButton.Position = UDim2.new(0, (#TabManager:GetChildren() - 2) * 100, 0, 0)
    TabButton.Text = "Tab " .. tostring(#TabManager:GetChildren() - 1)
    TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    TabButton.BorderSizePixel = 0

    -- Set up the CloseTabButton for the Tab
    CloseTabButton.Parent = TabButton
    CloseTabButton.BackgroundTransparency = 1
    CloseTabButton.Position = UDim2.new(1, -15, 0, 0)
    CloseTabButton.Size = UDim2.new(0, 15, 0, 15)
    CloseTabButton.Text = "X"
    CloseTabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseTabButton.BorderSizePixel = 0

    -- Set up the CodeBox
    CodeBox.Parent = MainFrame
    CodeBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    CodeBox.Position = UDim2.new(0, 0, 0, 60)
    CodeBox.Size = UDim2.new(1, 0, 1, -90)
    CodeBox.ClearTextOnFocus = false
    CodeBox.Font = Enum.Font.Code
    CodeBox.MultiLine = true
    CodeBox.Text = "-- Write your Lua code here"
    CodeBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    CodeBox.TextSize = 14
    CodeBox.TextXAlignment = Enum.TextXAlignment.Left
    CodeBox.TextYAlignment = Enum.TextYAlignment.Top
    CodeBox.Visible = false
    table.insert(CodeBoxes, CodeBox)

    -- Show the new tab's CodeBox and hide others
    local function selectTab()
        for _, cb in pairs(CodeBoxes) do
            cb.Visible = false
        end
        CodeBox.Visible = true
    end

    -- Select the tab when clicked
    TabButton.MouseButton1Click:Connect(selectTab)

    -- Function to close the tab
    CloseTabButton.MouseButton1Click:Connect(function()
        local tabIndex = TabButton.LayoutOrder
        table.remove(CodeBoxes, tabIndex + 1)
        TabButton:Destroy()
        CodeBox:Destroy()
        -- Rearrange tabs
        for i, child in ipairs(TabManager:GetChildren()) do
            if child:IsA("TextButton") and child ~= NewTabButton then
                child.Position = UDim2.new(0, (i - 1) * 100, 0, 0)
                child.LayoutOrder = i - 1
            end
        end
        -- Adjust the position of the NewTabButton
        NewTabButton.Position = UDim2.new(0, (#TabManager:GetChildren() - 1) * 100, 0, 0)
        -- Select the first remaining tab if it exists
        if #CodeBoxes > 0 then
            CodeBoxes[1].Visible = true
        end
    end)

    -- Adjust the position of the NewTabButton
    NewTabButton.Position = UDim2.new(0, (#TabManager:GetChildren() - 1) * 100, 0, 0)
    TabButton.LayoutOrder = #TabManager:GetChildren() - 2

    -- Automatically select the newly created tab
    selectTab()
end

-- Create the first tab by default
createNewTab()

-- Ensure the first tab is selected by default
if #CodeBoxes > 0 then
    CodeBoxes[1].Visible = true
end

-- Add functionality to the NewTabButton
NewTabButton.MouseButton1Click:Connect(createNewTab)

-- Add functionality to the ExecuteButton
ExecuteButton.MouseButton1Click:Connect(function()
    for _, cb in pairs(CodeBoxes) do
        if cb.Visible then
            local code = cb.Text
            -- Securely execute the code here
            -- Note: Use appropriate security measures for handling code execution
            print("Executing: " .. code)
        end
    end
end)

-- Add functionality to the CloseButton to close the entire UI
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Make the MainFrame draggable
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)
